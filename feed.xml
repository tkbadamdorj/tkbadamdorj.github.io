<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="4.3.4">Jekyll</generator><link href="https://tkbadamdorj.github.io/feed.xml" rel="self" type="application/atom+xml"/><link href="https://tkbadamdorj.github.io/" rel="alternate" type="text/html" hreflang="en"/><updated>2025-01-21T06:30:14+00:00</updated><id>https://tkbadamdorj.github.io/feed.xml</id><title type="html">Taivanbat Badamdorj (TK)</title><subtitle></subtitle><entry><title type="html">No more SQL: using ibis as a machine learning researcher</title><link href="https://tkbadamdorj.github.io/blog/2025/ibis/" rel="alternate" type="text/html" title="No more SQL: using ibis as a machine learning researcher"/><published>2025-01-20T15:09:00+00:00</published><updated>2025-01-20T15:09:00+00:00</updated><id>https://tkbadamdorj.github.io/blog/2025/ibis</id><content type="html" xml:base="https://tkbadamdorj.github.io/blog/2025/ibis/"><![CDATA[<h1 id="tldr">TL;DR:</h1> <ul> <li>I am afraid of SQL</li> <li><a href="https://pandas.pydata.org/"><code class="language-plaintext highlighter-rouge">pandas</code></a> <em>was</em> great until it wasn’t <ul> <li>it doesn’t do so well with large scale data</li> </ul> </li> <li><a href="https://duckdb.org/">duckdb</a> gives you a powerful backend for dealing with larger scale data, but you need to know SQL</li> <li><a href="https://ibis-project.org/"><code class="language-plaintext highlighter-rouge">ibis</code></a> lets you use pythonic, pandas-like syntax while letting you use duckdb as a backend <ul> <li>in total they have 20+ backends (also including polars and other SQL backends)</li> <li>using <code class="language-plaintext highlighter-rouge">ibis</code> lets you write and execute complicated SQL queries in a pythonic way</li> </ul> </li> </ul> <hr/> <h3 id="ml-researchers-have-low-self-esteem-because-they-cant-write-sql">ML researchers have low self-esteem because they can’t write SQL</h3> <p>The machine learning researcher pipeline goes: you get really good grades in university, go to grad school, work on common benchmark datasets with a huge focus improving the state-of-the-art by developing new algorithms.</p> <p>If you’re really bold, you collect and annotate your own dataset.</p> <p>Then you go to a company and you feel bad.</p> <p>“What? I have to access this table where? How do I query it? How do I transform it to get it into the format I want? How can I explore this? It doesn’t fit into memory as a lovely <code class="language-plaintext highlighter-rouge">DataFrame</code> that I can manipulate how I want to.”</p> <p>You’re stuck. You used to be a somebody.</p> <p>“If only… if only someone smarter than me wrote a tool that has a simple pythonic, pandas-like API that lets me do all the cool stuff the data engineers do,” you think to yourself.</p> <p>You look up. The data engineers are doing kickflips outside.</p> <h3 id="why-isnt-pandas-sufficient">Why isn’t <code class="language-plaintext highlighter-rouge">pandas</code> sufficient?</h3> <p><code class="language-plaintext highlighter-rouge">pandas</code> is the de-facto library that researchers have come to love and use. With its trove of useful functions and simple python syntax, it’s great when you’re not dealing with large scale data.</p> <p>As Wes McKinney, the creator of pandas says in “10 Things I Hate About Pandas” (<a href="https://wesmckinney.com/blog/apache-arrow-pandas-internals/">link</a>), his rule of thumb for pandas is that you should have <strong>5 to 10 times as much RAM</strong> as the size of your dataset. When you’re dealing with terabytes of data, this is impossible to achieve.</p> <p>In summary:</p> <ul> <li>ease of use ✅</li> <li>processing large scale data ❌</li> </ul> <h3 id="i-heard-a-quack-enter-duckdb">I heard a quack: enter <code class="language-plaintext highlighter-rouge">duckdb</code></h3> <p><a href="https://duckdb.org/">duckdb</a> on the other hand is an open source database system. You can query and transform your data anywhere, and as the website says, you can process larger-than-memory workloads! It’s a much better alternative to pandas in terms of dealing with large scale data, but you need to know SQL. For example, to get the average bill length and maximum flipper length for each group of birds (by species and island), the SQL query looks like the following:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># get average bill length and maximum flipper length
</span><span class="kn">import</span> <span class="n">duckdb</span>
<span class="n">duckdb</span><span class="p">.</span><span class="nf">sql</span><span class="p">(</span><span class="sh">"""</span><span class="s">
	SELECT 
	    species, 
	    island, 
	    AVG(bill_length_mm) AS </span><span class="sh">"</span><span class="s">Mean(bill_length_mm)</span><span class="sh">"</span><span class="s">, 
	    MAX(flipper_length_mm) AS </span><span class="sh">"</span><span class="s">Max(flipper_length_mm)</span><span class="sh">"</span><span class="s">
	FROM penguins
	GROUP BY species, island
    </span><span class="sh">"""</span><span class="p">)</span>
</code></pre></div></div> <p>Writing SQL inside of a python string is ok, but maybe not the prettiest.</p> <p>In summary:</p> <ul> <li>ease of use ❌ (if you don’t know SQL)</li> <li>processing large scale data ✅</li> </ul> <h3 id="the-ibis-has-landed">The <code class="language-plaintext highlighter-rouge">ibis</code> has landed</h3> <p>Thankfully, there’s a third alternative that combines ease of use with the ability to process large scale data.</p> <p><a href="https://ibis-project.org/why">ibis</a> is a python package that acts as an interface between you and the query engine. ibis supports over 20 query engines including duckdb. On top of that they support polars, BiqQuery, ClickHouse, MySQL, PostgreSQL, and a variety of others!</p> <p>The whole philosophy behind ibis is to create a common user interface for all the different query engines. You can change what query engine to use without changing any of your ibis code.</p> <p>With <code class="language-plaintext highlighter-rouge">ibis</code>, we can rewrite the example above in a much more pythonic way:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">ibis</span>
<span class="p">(</span>
    <span class="n">penguins</span>
    <span class="p">.</span><span class="nf">group_by</span><span class="p">([</span><span class="n">penguins</span><span class="p">.</span><span class="n">species</span><span class="p">,</span> <span class="n">penguins</span><span class="p">.</span><span class="n">island</span><span class="p">])</span>
    <span class="p">.</span><span class="nf">aggregate</span><span class="p">(</span>
        <span class="p">[</span>
	        <span class="n">penguins</span><span class="p">.</span><span class="n">bill_length_mm</span><span class="p">.</span><span class="nf">mean</span><span class="p">(),</span> 
	        <span class="n">penguins</span><span class="p">.</span><span class="n">flipper_length_mm</span><span class="p">.</span><span class="nf">max</span><span class="p">()</span>
	    <span class="p">]</span>
    <span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div> <p>I found the syntax much more friendly compared to duckdb. Since the backend uses duckdb, we also don’t lose out on any performance benefits by using ibis.</p> <p>ibis thus meets the two things we were looking for:</p> <ul> <li>ease of use ✅</li> <li>processing large scale data ✅</li> </ul> <p>Another benefit of ibis is that since it is query engine-agnostic, if one of the query engines develops a new feature that is way faster than the others, you don’t have to rewrite your ibis code! You can just change the backend.</p> <h3 id="you-can-pretend-to-be-a-cool-data-engineer-now">You can pretend to be a cool data engineer now</h3> <p>Now that you know about <code class="language-plaintext highlighter-rouge">ibis</code> you can do some of the things that the cool skateboarding data engineers can do. You won’t be able to do all the cool things they can do, but hey at least you won’t embarrass yourself any further.</p> <p>Give ibis a try! I found the <code class="language-plaintext highlighter-rouge">ibis</code> tutorials <a href="https://ibis-project.org/tutorials/getting_started#group_by">here</a> very useful.</p>]]></content><author><name></name></author><category term="sample-posts"/><category term="shorts"/><category term="data-engineering"/><summary type="html"><![CDATA[How to give in to your fears of SQL and/or possibly improve your life]]></summary></entry></feed>